<%page expression_filter="h"/>
<%inherit file="../main.html" />
<%def name="online_help_token()"><% return "learnerdashboard" %></%def>
<%namespace name='static' file='../static_content.html'/>
<%!
import pytz
from datetime import datetime, timedelta
from django.urls import reverse
from django.utils.translation import ugettext as _
from django.template import RequestContext
from entitlements.models import CourseEntitlement
from third_party_auth import pipeline
from util.date_utils import strftime_localized
from opaque_keys.edx.keys import CourseKey
from openedx.core.djangoapps.content.course_overviews.models import CourseOverview
from openedx.core.djangoapps.site_configuration import helpers as configuration_helpers
from openedx.core.djangolib.js_utils import dump_js_escaped_json, js_escaped_string
from openedx.core.djangolib.markup import HTML, Text
from student.models import CourseEnrollment
from opaque_keys.edx.keys import CourseKey
from lms.djangoapps.courseware.courses import (
  get_course_overview_with_access,
  get_course
)
from openedx.features.course_experience import course_home_url_name
from lms.djangoapps.tma_apps.models import TmaCourseEnrollment, TmaCourseOverview
from lms.djangoapps.tma_apps.vodeclic.vodeclic import get_vodeclic_href
from lms.djangoapps.tma_apps.certificates.certificate import certificate
import logging
log = logging.getLogger(__name__)
%>

<%block name="pagetitle">${_("Dashboard")}</%block>

<%
ongoing_program_enrollments = programs.values()
program_courses = {}

for program in ongoing_program_enrollments:
    if program.id not in program_courses.keys():
        program_courses[program.id] = []

        for course_id in courses[program.id]:
            program_courses[program.id].append(course_id)
%>

<!-- TMA enable BOOTSTRAP-->
<link rel="stylesheet" type="text/css" href="${static.url('css/bootstrap/lms-main.css')}">
<script type="text/javascript" src="${static.url('common/js/vendor/bootstrap.bundle.js')}"></script>

<!-- TMA GLOBAL STYLE -->
<link href="https://fonts.googleapis.com/css?family=Montserrat:300,500" rel="stylesheet">
<link rel="stylesheet" href="${static.url('tma-static/css/home-tma-custom.css')}">
<link rel="stylesheet" href="${static.url('tma-static/css/global-tma-custom.css')}">
<link rel="stylesheet" href="${static.url('tma-static/css/likes-and-favorite.css')}">
<div id="cards-box" class="container-fluid bg-white" style="min-height:100vh;">
    <div class="row">
        <div class="col home-box">
            <div class="row mt-5">
                <div class="col">
                    <h1 class="title-36-black mb-5">${_("Your dashboard")}</h1>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-1 text-right">
                    % if user.first_name and user.last_name:
                        <div class="profile-img">${user.first_name[0] + user.last_name[0]}</div>
                    % else:
                        <div class="profile-img"></div>
                    % endif
                </div>
                <div class="col-lg-5">
                    % if user.first_name and user.last_name:
                        <h2 class="title-24"><span class="font-weight-bold">${_("Hello")}</span> ${user.first_name}</h2>
                    % else:
                        <h2 class="title-24"><span class="font-weight-bold">${_("Hello")}</span> ${user.username}</h2>
                    % endif
                    <p class="grey-text">${_("You'll find on this page all the programs you have been invited to, as well as the completion status.")}</p>
                </div>
            </div>
        </div>
    </div>
    <div class="row position-relative">
        <div class="container-fluid padding-70 pt-4 pb-4 ongoing-box ">
        % if ongoing_program_enrollments:
            % for program in ongoing_program_enrollments:
                <div class="bg-blue-box" style="left:0;"></div>
                    <div class="row pt-4">
                        <h1 class="title-28 text-white"><img class="picto" src="${static.url('tma-static/images/drapeau.svg')}">${program.program_name}</h1>
                    </div>
                    <div class="row">
                        % for course in program_courses[program.id]:
                            <%include file='program_card.html' />
                        % endfor
                    </div>
            % endfor
        % else:
            <div class="row" style="margin-bottom:180px;">
                <div style="margin:0 auto;z-index:2"><p class="text-white">${_("You have no ongoing programs yet")}</p></div>
            </div>

        % endif    
        </div>
    </div>
    
</div>
<script src="${static.url('tma-static/js/home-dashboard-actions.js')}" charset="utf-8"></script>
<script src="${static.url('tma-static/js/likes-and-favorite.js')}" charset="utf-8"></script>